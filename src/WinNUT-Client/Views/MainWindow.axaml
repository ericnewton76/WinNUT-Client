<Window xmlns="https://github.com/avaloniaui"
				xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
				xmlns:vm="using:WinNUT_Client.ViewModels"
				xmlns:views="using:WinNUT_Client.Views"
				xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
				xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
				mc:Ignorable="d" d:DesignWidth="650" d:DesignHeight="450"
				x:Class="WinNUT_Client.Views.MainWindow"
				x:DataType="vm:MainWindowViewModel"
				Icon="/Assets/WinNut.ico"
				Title="WinNUT-Client"
				Width="{Binding RecommendedWidth, Mode=OneWay}" Height="450"
				MinWidth="500" MinHeight="420"
				MaxWidth="850">

	<Design.DataContext>
		<vm:MainWindowViewModel/>
	</Design.DataContext>

	<DockPanel>
		<!-- Menu Bar -->
		<Menu DockPanel.Dock="Top">
			<MenuItem Header="_File">
				<MenuItem Header="_Connect" Command="{Binding ConnectCommand}" IsEnabled="{Binding !IsConnected}">
					<MenuItem.Icon>
						<PathIcon Data="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6Z" />
					</MenuItem.Icon>
				</MenuItem>
				<MenuItem Header="_Disconnect" Command="{Binding DisconnectCommand}" IsEnabled="{Binding IsConnected}" />
				<Separator />
				<MenuItem Header="E_xit" Command="{Binding ExitCommand}" InputGesture="Alt+F4" />
			</MenuItem>
			<MenuItem Header="_View">
				<MenuItem Header="_UPS Variables" Command="{Binding ShowUpsVariablesCommand}" IsEnabled="{Binding IsConnected}" />
				<Separator />
				<MenuItem Header="View _Log File" Command="{Binding ViewLogFileCommand}" />
			</MenuItem>
			<MenuItem Header="_Tools">
				<MenuItem Header="_Preferences" Command="{Binding ShowPreferencesCommand}" InputGesture="Ctrl+P" />
			</MenuItem>
			<MenuItem Header="_Help">
				<MenuItem Header="_About" Command="{Binding ShowAboutCommand}" />
				<MenuItem Header="_GitHub Repository" Command="{Binding OpenGitHubCommand}" />
			</MenuItem>
		</Menu>

		<!-- Status Bar at bottom -->
		<Border DockPanel.Dock="Bottom" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" Padding="5">
			<Grid ColumnDefinitions="Auto,*">
				<!-- Freshness indicator -->
				<Ellipse Grid.Column="0" Width="12" Height="12" Fill="{Binding DataFreshnessColor}" 
								 Margin="0,0,8,0" ToolTip.Tip="{Binding DataFreshnessTooltip}" />
				<TextBlock Grid.Column="1" Text="{Binding ConnectionStatus}" VerticalAlignment="Center" />
			</Grid>
		</Border>

		<!-- Toolbar -->
		<Border DockPanel.Dock="Top" Padding="5" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
			<StackPanel Orientation="Horizontal" Spacing="5">
				<Button Content="Connect" Command="{Binding ConnectCommand}" IsEnabled="{Binding !IsConnected}" />
				<Button Content="Disconnect" Command="{Binding DisconnectCommand}" IsEnabled="{Binding IsConnected}" />
				<Separator Width="1" Margin="5,0" />
				<Button Content="Preferences" Command="{Binding ShowPreferencesCommand}" />
			</StackPanel>
		</Border>

		<!-- Main content area with optional sidebar -->
		<Grid ColumnDefinitions="Auto,*">
			
			<!-- UPS Sidebar (visible when multiple UPS) -->
			<Border Grid.Column="0" 
							IsVisible="{Binding ShowSidebar}"
							Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
							Width="200" Padding="5">
				<ScrollViewer VerticalScrollBarVisibility="Auto">
					<ItemsControl ItemsSource="{Binding UpsList}">
						<ItemsControl.ItemTemplate>
							<DataTemplate DataType="vm:UpsSummary">
								<Border Margin="5" Padding="10" CornerRadius="5"
												Background="{Binding IsSelected, Converter={StaticResource BoolToBackgroundConverter}}"
												BorderThickness="2"
												BorderBrush="{Binding StatusColor}"
												PointerPressed="SidebarItem_PointerPressed"
												Cursor="Hand">
									<Border.ContextMenu>
										<ContextMenu>
											<MenuItem Header="Connect" Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ConnectUpsCommand}" 
																CommandParameter="{Binding}" />
											<MenuItem Header="Disconnect" Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).DisconnectUpsCommand}"
																CommandParameter="{Binding}" />
											<Separator />
											<MenuItem Header="View Variables" Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ShowUpsVariablesCommand}" />
										</ContextMenu>
									</Border.ContextMenu>
									<Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
										<!-- Battery Icon -->
										<Image Grid.Column="0" Source="{Binding BatteryIcon}" 
													 Width="24" Height="24" VerticalAlignment="Top" Margin="0,2,0,0" />
										
										<StackPanel Grid.Column="1" Spacing="3" MaxWidth="125">
											<!-- UPS Name -->
											<TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" FontSize="12" TextTrimming="CharacterEllipsis" />
											<TextBlock Text="{Binding Host}" FontSize="10" TextTrimming="CharacterEllipsis"
																 Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
											
											<!-- Status text -->
											<TextBlock Text="{Binding StatusText}" FontSize="10" 
																 Foreground="{Binding StatusColor}" />
											
											<!-- Battery bar -->
											<Grid ColumnDefinitions="*,Auto" Margin="0,2,0,0">
												<ProgressBar Grid.Column="0" Value="{Binding BatteryCharge}" Maximum="100" 
																		 Height="5" CornerRadius="2" MinWidth="50" />
												<TextBlock Grid.Column="1" Text="{Binding BatteryCharge, StringFormat={}{0:F0}%}" 
																	 FontSize="9" Margin="5,0,0,0" VerticalAlignment="Center" />
											</Grid>
										</StackPanel>
									</Grid>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</ScrollViewer>
			</Border>

			<!-- Main content - UPS Card -->
			<ScrollViewer Grid.Column="1" Margin="10" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
				<views:UpsCard DataContext="{Binding UpsCard}" />
			</ScrollViewer>
		</Grid>
	</DockPanel>

</Window>
